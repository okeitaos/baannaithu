<!-- <!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üçú POS ‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
body{background:#020617;color:#e5e7eb}
select,input{color:#000}
</style>
</head>

<body class="p-3 space-y-3">

<h1 class="text-xl font-bold text-center">üçú POS ‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô</h1>

<select id="tableSelect" class="w-full p-2 rounded"></select>

<div id="categoryBar" class="flex gap-2 overflow-x-auto"></div>
<div id="menu" class="grid grid-cols-2 gap-2"></div>

<div class="bg-slate-800 p-3 rounded">
  <div id="bill"></div>
  <div class="border-t mt-2 pt-2 font-bold">
    ‡∏£‡∏ß‡∏°: <span id="total" class="text-emerald-400">0</span> ‡∏ö‡∏≤‡∏ó
  </div>
</div>

<div class="flex gap-2">
  <button id="btnKitchen" class="flex-1 bg-sky-600 py-3 rounded">üç≥ ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ß</button>
  <button id="btnCheckout" class="flex-1 bg-emerald-600 py-3 rounded">üí∞ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡∏¥‡∏•</button>
</div>

<button id="btnCancel" class="w-full bg-red-600 py-2 rounded">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏¥‡∏•</button>

<script>
/* ================= CONFIG ================= */
const db = supabase.createClient(
  "https://nvsptbbvxjulrpdebrhn.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52c3B0YmJ2eGp1bHJwZGVicmhuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MTc1NTAsImV4cCI6MjA4MzE5MzU1MH0.sQ8XqdAKCsaxWupP3QZjFOraEHyW8agSo3c3BR3I8ss"
);

let categories=[], products=[], tables=[];
let cart=[], currentOrderId=null;
let openOrderMap={};

/* ================= INIT ================= */
document.addEventListener('DOMContentLoaded', init);

async function init(){
  categories=(await db.from('categories').select()).data||[];
  products=(await db.from('products').select().eq('active',true)).data||[];
  tables=(await db.from('tables').select().eq('active',true)).data||[];

  bindButtons();
  renderCategories();
  await loadTables();
  if(categories[0]) loadCategory(categories[0].name);
}

/* ================= EVENTS ================= */
function bindButtons(){
  document.getElementById('btnKitchen').onclick = sendToKitchen;
  document.getElementById('btnCheckout').onclick = checkout;
  document.getElementById('btnCancel').onclick = cancelOrder;
  document.getElementById('tableSelect').onchange = onSelectTable;
}

/* ================= TABLE ================= */
async function loadTables(){
  tableSelect.innerHTML='<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞ --</option>';
  openOrderMap={};

  const { data } = await db.from('orders')
    .select('id,table_id').eq('status','open');

  data.forEach(o=>openOrderMap[o.table_id]=o.id);

  tables.forEach(t=>{
    tableSelect.innerHTML+=`
      <option value="${t.id}">
        ${t.name}${openOrderMap[t.id]?' (‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà)':''}
      </option>`;
  });
}

async function onSelectTable(){
  const tableId=tableSelect.value;
  if(!tableId) return;

  if(openOrderMap[tableId]){
    currentOrderId=openOrderMap[tableId];
    const { data } = await db.from('order_items')
      .select('*').eq('order_id',currentOrderId);

    cart=data.map(i=>({name:i.product_name,price:i.price,qty:i.qty}));
  }else{
    const { data:o } = await db.from('orders')
      .insert({table_id:tableId,status:'open'})
      .select().single();

    currentOrderId=o.id;
    cart=[];
  }
  renderBill();
}

/* ================= MENU ================= */
function renderCategories(){
  categoryBar.innerHTML='';
  categories.forEach(c=>{
    const b=document.createElement('button');
    b.className='bg-slate-700 px-4 py-2 rounded';
    b.textContent=c.name;
    b.onclick=()=>loadCategory(c.name);
    categoryBar.appendChild(b);
  });
}

function loadCategory(cat){
  menu.innerHTML='';
  products.filter(p=>p.category===cat).forEach(p=>{
    const b=document.createElement('button');
    b.className='bg-slate-700 p-3 rounded';
    b.textContent=`${p.name}\n${p.price} ‡∏ö‡∏≤‡∏ó`;
    b.onclick=()=>addItem(p);
    menu.appendChild(b);
  });
}

/* ================= CART ================= */
function addItem(p){
  const f=cart.find(i=>i.name===p.name);
  f?f.qty++:cart.push({name:p.name,price:p.price,qty:1});
  renderBill();
}

function renderBill(){
  bill.innerHTML='';
  let sum=0;
  cart.forEach(i=>{
    bill.innerHTML+=`
      <div class="flex justify-between border-b py-1">
        <span>${i.name} √ó ${i.qty}</span>
        <span>${i.price*i.qty}</span>
      </div>`;
    sum+=i.price*i.qty;
  });
  total.textContent=sum;
}

/* ================= ACTIONS ================= */
async function sendToKitchen(){
  if(!currentOrderId||!cart.length) return;

  await db.from('order_items').delete().eq('order_id',currentOrderId);
  for(const i of cart){
    await db.from('order_items').insert({
      order_id:currentOrderId,
      product_name:i.name,
      price:i.price,
      qty:i.qty
    });
  }
  Swal.fire({icon:'success',title:'‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ß‡πÅ‡∏•‡πâ‡∏ß',timer:1000});
}

async function checkout(){
  if(!currentOrderId) return;
  await sendToKitchen();
  await db.from('orders').update({status:'paid'}).eq('id',currentOrderId);
  resetAll();
}

async function cancelOrder(){
  if(!currentOrderId) return;
  await db.from('order_items').delete().eq('order_id',currentOrderId);
  await db.from('orders').delete().eq('id',currentOrderId);
  resetAll();
}

async function resetAll(){
  cart=[]; currentOrderId=null;
  renderBill();
  tableSelect.value='';
  await loadTables();
}
</script>

</body>
</html> -->
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TEST BUTTON</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="p-4 bg-slate-900 text-white">

<button id="btn" class="bg-emerald-600 px-6 py-3 rounded">
  ‡∏Å‡∏î‡∏â‡∏±‡∏ô‡∏™‡∏¥
</button>

<script>
document.getElementById('btn').addEventListener('click',()=>{
  alert('‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
});
</script>

</body>
</html>
